import subprocess
import time

def start_dump1090():
    print("Starting dump1090...")
    return subprocess.Popen(['./dump1090', '--net', '--interactive', '--loop', '--ifile', 'testfile/modes1.bin'])

def start_receiving_program():
    print("Starting receiving program...")
    return subprocess.Popen(['python', 'receiving_program.py'])

def start_flask_app():
    print("Starting Flask app...")
    return subprocess.Popen(['python', 'tcp_to_csv_flask.py'])

def main():
    # Start dump1090
    dump1090_process = start_dump1090()
    time.sleep(5)  # Give dump1090 some time to start

    # Start receiving program
    receiving_program_process = start_receiving_program()
    time.sleep(5)  # Give the receiving program some time to start

    # Start Flask app
    flask_app_process = start_flask_app()

    # Wait for the processes to complete (they won't, since they're running servers)
    try:
        dump1090_process.wait()
        receiving_program_process.wait()
        flask_app_process.wait()
    except KeyboardInterrupt:
        print("Stopping all processes...")
        dump1090_process.terminate()
        receiving_program_process.terminate()
        flask_app_process.terminate()

if __name__ == '__main__':
    main()
