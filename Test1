from flask import Flask, request, jsonify, render_template, Response
import json

app = Flask(__name__)
data_list = []

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/data', methods=['POST'])
def receive_data():
    global data_list
    content = request.json
    data_list.append(content)
    return jsonify(success=True)

@app.route('/stream')
def stream():
    def event_stream():
        while True:
            if data_list:
                data = data_list.pop(0)
                yield f"data: {json.dumps(data)}\n\n"
    return Response(event_stream(), mimetype="text/event-stream")

@app.route('/export', methods=['GET'])
def export_data():
    global data_list
    with open('data.txt', 'w') as file:
        for entry in data_list:
            file.write(json.dumps(entry) + '\n')
    return jsonify(success=True, message='Data exported to data.txt')

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)